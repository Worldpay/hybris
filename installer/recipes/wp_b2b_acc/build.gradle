// Hybris b2b_acc_plus recipe extended with Worldpay addon
apply plugin: 'installer-platform-plugin'
apply plugin: 'installer-addon2-plugin'

def pl = platform {
    localProperties {
        property 'recaptcha.publickey', ''
        property 'recaptcha.privatekey', ''
        property 'googleApiKey', ''
        property 'website.powertools.http', 'http://powertools.local:9001/yb2bacceleratorstorefront'
        property 'website.powertools.https', 'https://powertools.local:9002/yb2bacceleratorstorefront'
        property 'testclasses.addonname', 'yb2bacceleratorstorefront'
        property 'ansi.colors', 'true'

        property 'worldpay.config.3dsecureflex.jwt.alg', 'hs256'
        property 'worldpay.config.3dsecureflex.jwt.challengeurl', 'https://secure-test.worldpay.com/shopper/3ds/challenge.html'
        property 'worldpay.config.3dsecureflex.jwt.ddcurl', 'https://secure-test.worldpay.com/shopper/3ds/ddc.html'
        property 'worldpay.config.3dsecureflex.jwt.eventOriginDomain', 'https://secure-test.worldpay.com'
        property 'worldpay.config.3dsecureflex.jwt.returnurl', '/checkout/multi/worldpay/3dsecureflex/sop/response'
        property 'worldpay.config.3dsecureflex.challengepreference', 'noPreference'
        property 'worldpay.config.3dsecureflex.secondauthorisation.submit.url', '/checkout/multi/worldpay/3dsecureflex/sop/response/autosubmit'
        property 'worldpay.config.3dsecureflex.jwt.flowReturnUrl', '/checkout/multi/worldpay/3dsecureflex/sop/response'

        property 'worldpay.config.web.merchant.card.acceptor.taxId', '123456789'

        property 'worldpay.config.web.merchant.code.powertools', 'MERCHANTREL60ECOM'
        property 'worldpay.config.web.merchant.password.powertools', '3l3ph4nt_and_c4st!3'
        property 'worldpay.config.web.merchant.macSecret.powertools', '3l3ph4nt_AND_c4st!3s'
        property 'worldpay.config.web.googlePay.gatewayMerchantId.powertools', ''
        property 'worldpay.config.web.merchant.installationId.powertools', '1048564'
        property 'worldpay.config.web.merchant.statementNarrative.powertools', ''
        property 'worldpay.config.asm.merchant.code.powertools', 'MERCHANTREL60MOTO'
        property 'worldpay.config.asm.merchant.password.powertools', 'Ru553!!_5qu4r3'
        property 'worldpay.config.asm.merchant.macSecret.powertools', 'Ru553!!_5qu4r3Ru553!!_5qu4r3'
        property 'worldpay.config.asm.merchant.installationId.powertools', '1048564'
        property 'worldpay.config.asm.merchant.statementNarrative.powertools', ''
        property 'worldpay.config.replenishment.merchant.code.powertools', 'MERCHANTREL60RECUR'
        property 'worldpay.config.replenishment.merchant.password.powertools', 'Ru553!!_5qu4r3'
        property 'worldpay.config.replenishment.merchant.macSecret.powertools', 'Ru553!!_5qu4r3Ru553!!_5qu4r3'
        property 'worldpay.config.replenishment.merchant.installationId.powertools', '1048564'
        property 'worldpay.config.replenishment.merchant.statementNarrative.powertools', ''
        property 'worldpay.config.3dsecureflex.jwt.iss.powertools', ''
        property 'worldpay.config.3dsecureflex.jwt.jwtmackey.powertools', ''
        property 'worldpay.config.3dsecureflex.jwt.orgunitid.powertools', ''
    }

    afterSetup {
        ensureAdminPasswordSet()
    }

    extensions {
        /* extgened extensions*/
            extName 'yb2bacceleratorstorefront'
        /* adaptive-search*/
            extName 'adaptivesearchsolr'
            extName 'adaptivesearchbackoffice'
            extName 'adaptivesearchsamplesaddon'
            extName 'adaptivesearchwebservices'
        /* assisted-services*/
            extName 'assistedservicestorefront'
            extName 'assistedservicewebservices'
        /* b2b-accelerator*/
            extName 'b2bacceleratoraddon'
            extName 'powertoolsstore'
            extName 'commerceorgaddon'
            extName 'commerceorgsamplesaddon'
        /* b2b-accelerator-addons*/
            extName 'b2bpunchoutaddon'
            extName 'secureportaladdon'
            extName 'accountsummaryaddon'
        /* b2b-commerce*/
            extName 'b2bcommercebackoffice'
        /* b2c-accelerator-addons*/
            extName 'captchaaddon'
        /* backoffice-addons*/
            extName 'pcmbackofficesamplesaddon'
        /* base-accelerator*/
            extName 'yacceleratorbackoffice'
            extName 'yacceleratorinitialdata'
            extName 'yacceleratorfulfilmentprocess'
        /* commerce-services*/
            extName 'commercefacades'
            extName 'commerceservices'
            extName 'commerceservicesbackoffice'
            extName 'commercewebservices'
            extName 'commercewebservicescommons'
            extName 'commercewebservicestests'
        /* configurable-bundle*/
            extName 'configurablebundleaddon'
        /* configurator-complex-products*/
            extName 'sapproductconfigb2baddon'
            extName 'sapproductconfigb2bservices'
            extName 'sapproductconfigfacades'
            extName 'sapproductconfigrules'
            extName 'sapproductconfigrulesbackoffice'
            extName 'sapproductconfigruntimeinterface'
            extName 'sapproductconfigruntimemock'
            extName 'sapproductconfigservices'
        /* consignment-tracking*/
            extName 'consignmenttrackingaddon'
            extName 'consignmenttrackingmock'
            extName 'consignmenttrackingbackoffice'
        /* coupon*/
            extName 'couponbackoffice'
            extName 'couponfacades'
            extName 'couponservices'
        /* customer-service*/
            extName 'customerticketingaddon'
            extName 'customersupportbackoffice'
        /*  order-management*/
            extName 'orderselfserviceaddon'
        /* personalization*/
            extName 'previewpersonalizationweb'
            extName 'personalizationcmsweb'
            extName 'personalizationsmartedit'
            extName 'personalizationpromotionssmartedit'
            extName 'personalizationsampledataaddon'
            extName 'personalizationpromotionssampledataaddon'
            extName 'personalizationpromotions'
            extName 'personalizationpromotionsweb'
            extName 'personalizationservicesbackoffice'
            extName 'personalizationpromotionsbackoffice'
            extName 'personalizationcmsbackoffice'
            extName 'personalizationsearchbackoffice'
            extName 'personalizationsearchsmartedit'
            extName 'personalizationsearchweb'
            extName 'personalizationsearchsamplesaddon'
        /* promotion-engine*/
            extName 'promotionenginesamplesaddon'
        /* rule-engine*/
            extName 'rulebuilderbackoffice'
            extName 'droolsruleengineservices'
        /* sap-btp-extensions-integration*/
            extName 'kymaintegrationbackoffice'
        /*  search-and-navigation*/
            extName 'solrfacetsearchbackoffice'
            extName 'solrserver'
        /* smartedit*/
            extName 'smarteditwebservices'
            extName 'smarteditaddon'
            extName 'cmssmartedit'
            extName 'cmssmarteditwebservices'
        /* text-field-configurator-template*/
            extName 'textfieldconfiguratortemplatebackoffice'
            extName 'textfieldconfiguratortemplateaddon'
        /* web-content-management-system*/
            extName 'cms2'
            extName 'webservicescommons'
            extName 'cmswebservices'
            extName 'cmsbackoffice'
            extName 'previewwebservices'
        /* web-services-commons*/
            extName 'permissionswebservices'
        /* integration-apis */
            extName 'outboundservices'
            extName 'odata2webservices'
            extName 'odata2webservicesfeaturetests'
        /* Worldpay extensions */
            extName 'worldpayaddonbackoffice'
            extName 'worldpayapi'
            extName 'worldpayb2baddon'
            extName 'worldpaynotifications'
            extName 'worldpaysampledataaddon'
            extName 'worldpayhac'
            extName 'worldpayfulfilment'
    }


    addons {
        forStoreFronts('yb2bacceleratorstorefront') {
            names('worldpayb2baddon', 'worldpaysampledataaddon', 'b2bacceleratoraddon', 'commerceorgaddon', 'commerceorgsamplesaddon', 'b2bpunchoutaddon', 'secureportaladdon',
                'accountsummaryaddon', 'assistedservicestorefront', 'captchaaddon', 'customerticketingaddon',
                'textfieldconfiguratortemplateaddon', 'orderselfserviceaddon', 'smarteditaddon', 'adaptivesearchsamplesaddon',
                'consignmenttrackingaddon', 'configurablebundleaddon', 'pcmbackofficesamplesaddon', 'sapproductconfigb2baddon')
            template 'yacceleratorstorefront'
        }
    }
}

task createStoreFrontExt {
    doLast {
        def prePlatform = platformFactory.createPlatform()
        prePlatform.createConfigDirIfNotExist()
        prePlatform.resetConfig()

        prePlatform.createExtension {
            templateName 'yacceleratorstorefront'
            extensionName 'yb2bacceleratorstorefront'
            packageName 'de.hybris.platform.yb2bacceleratorstorefront'
        }
    }
}

task setup(dependsOn: createStoreFrontExt) {
    doLast {
        pl.setup()
    }
}

task buildSystem(dependsOn: setup) {
    doLast {
        pl.build()
    }
}

task initialize(dependsOn: buildSystem) {
    doLast {
        pl.initialize()
    }
}

task start {
    doLast {
        pl.start()
    }
}

task startInBackground {
    doLast {
        pl.startInBackground()
    }
}

task stopInBackground {
    doLast {
        pl.stopInBackground()
    }
}
