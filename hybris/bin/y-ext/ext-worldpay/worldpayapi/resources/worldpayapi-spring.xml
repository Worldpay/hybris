<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

    <import resource="classpath:/merchants/merchants.xml"/>
    <import resource="classpath:/fulfilment/worldpayapi-order-actions-spring.xml"/>
    <import resource="classpath:/gateway/worldpayapi-gateway-spring.xml"/>
    <import resource="classpath:/converters/worldpayapi-converters-spring.xml"/>
    <import resource="classpath:/applepay/worldpayapi-applepay-spring.xml"/>

    <alias name="worldpayCustomerAccountService" alias="customerAccountService"/>
    <bean id="worldpayCustomerAccountService"
          class="com.worldpay.customer.impl.DefaultWorldpayCustomerAccountService"
          parent="defaultCustomerAccountService">
        <property name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <property name="worldpayDirectOrderService" ref="worldpayDirectOrderService"/>
    </bean>

    <!-- Worldpay Merchants -->
    <alias name="defaultWorldpayMerchantInfoService" alias="worldpayMerchantInfoService"/>
    <bean id="defaultWorldpayMerchantInfoService" class="com.worldpay.merchant.impl.DefaultWorldpayMerchantInfoService">
        <property name="worldpayMerchantStrategy" ref="worldpayMerchantStrategy"/>
    </bean>

    <alias name="defaultWorldpayMerchantConfigDataService" alias="worldpayMerchantConfigDataService"/>
    <bean id="defaultWorldpayMerchantConfigDataService"
          class="com.worldpay.merchant.impl.DefaultWorldpayMerchantConfigDataService">
        <property name="siteConfigService" ref="siteConfigService"/>
    </bean>

    <alias name="defaultWorldpayMerchantStrategy" alias="worldpayMerchantStrategy"/>
    <bean id="defaultWorldpayMerchantStrategy" class="com.worldpay.strategy.impl.DefaultWorldpayMerchantStrategy">
        <property name="worldpayMerchantConfigDataService" ref="worldpayMerchantConfigDataService"/>
        <property name="assistedServiceService" ref="defaultAssistedServiceService"/>
    </bean>

    <alias name="defaultWorldpayMerchantConfigDataFacade" alias="worldpayMerchantConfigDataFacade"/>
    <bean id="defaultWorldpayMerchantConfigDataFacade"
          class="com.worldpay.facades.payment.merchant.impl.DefaultWorldpayMerchantConfigDataFacade">
        <property name="worldpayMerchantStrategy" ref="worldpayMerchantStrategy"/>
    </bean>

    <!-- Strategies -->
    <alias name="defaultWorldpayOrderInfoStrategy" alias="worldpayOrderInfoStrategy"/>
    <bean id="defaultWorldpayOrderInfoStrategy"
          class="com.worldpay.merchant.strategies.impl.DefaultWorldpayOrderInfoStrategy"/>

    <alias name="defaultWorldpayCustomerIpAddressStrategy" alias="worldpayCustomerIpAddressStrategy"/>
    <bean id="defaultWorldpayCustomerIpAddressStrategy"
          class="com.worldpay.strategy.impl.DefaultWorldpayCustomerIpAddressStrategy">
        <property name="headerName" value="X-Forwarded-For"/>

        <!-- Possible headers that contain the customer IP
            <property name="headerName" value="Proxy-Client-IP"/>
            <property name="headerName" value="WL-Proxy-Client-IP"/>
            <property name="headerName" value="HTTP_CLIENT_IP"/>
            <property name="headerName" value="HTTP_X_FORWARDED_FOR"/>
        -->
    </bean>

    <!-- Worldpay Commands (Direct Authorise) -->
    <bean name="worldpayCommand" abstract="true" class="com.worldpay.commands.impl.WorldpayCommand">
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <constructor-arg name="worldpayPaymentTransactionService" ref="worldpayPaymentTransactionService"/>
        <constructor-arg name="worldpayServiceGateway" ref="worldpayServiceGateway"/>
        <constructor-arg name="worldpayRequestService" ref="worldpayRequestService"/>
    </bean>

    <bean name="worldpayCommandFactory"
          class="de.hybris.platform.payment.commands.factory.impl.DefaultCommandFactoryImpl">
        <property name="paymentProvider" value="Worldpay"/>
        <property name="commands">
            <map>
                <entry>
                    <key>
                        <value type="java.lang.Class">de.hybris.platform.payment.commands.CaptureCommand</value>
                    </key>
                    <bean class="com.worldpay.commands.impl.DefaultWorldpayCaptureCommand" parent="worldpayCommand">
                        <constructor-arg name="captureServiceResponseConverter" ref="captureServiceResponseConverter"/>
                        <constructor-arg name="worldpayHybrisOrderService" ref="worldpayHybrisOrderService"/>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <value type="java.lang.Class">de.hybris.platform.payment.commands.PartialCaptureCommand</value>
                    </key>
                    <bean class="com.worldpay.commands.impl.DefaultWorldpayCaptureCommand" parent="worldpayCommand">
                        <constructor-arg name="captureServiceResponseConverter" ref="captureServiceResponseConverter"/>
                        <constructor-arg name="worldpayHybrisOrderService" ref="worldpayHybrisOrderService"/>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <value type="java.lang.Class">de.hybris.platform.payment.commands.VoidCommand</value>
                    </key>
                    <bean class="com.worldpay.commands.impl.DefaultWorldpayVoidCommand" parent="worldpayCommand">
                        <constructor-arg name="voidServiceResponseConverter" ref="voidServiceResponseConverter"/>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <value type="java.lang.Class">de.hybris.platform.payment.commands.FollowOnRefundCommand</value>
                    </key>
                    <bean class="com.worldpay.commands.impl.DefaultWorldpayFollowOnRefundCommand"
                          parent="worldpayCommand">
                        <constructor-arg name="refundServiceResponseConverter" ref="refundServiceResponseConverter"/>
                    </bean>
                </entry>
                <entry>
                    <key>
                        <value type="java.lang.Class">
                            de.hybris.platform.payment.commands.SubscriptionAuthorizationCommand
                        </value>
                    </key>
                    <bean class="com.worldpay.commands.impl.DefaultWorldpayTokenisedAuthorizationCommand"
                          parent="worldpayCommand">
                        <constructor-arg name="worldpayAuthorizationResultConverter"
                                         ref="worldpayTokenisedDirectAuthorizationResponseConverter"/>
                        <constructor-arg name="worldpayBillingInfoAddressConverter"
                                         ref="worldpayBillingInfoAddressConverter"/>
                        <constructor-arg name="worldpayRequestService" ref="worldpayRequestService"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="abstractWorldpayOrderService" class="com.worldpay.service.payment.impl.AbstractWorldpayOrderService"
          abstract="true">
        <constructor-arg name="worldpayPaymentInfoService" ref="worldpayPaymentInfoService"/>
        <constructor-arg name="worldpayPaymentTransactionService" ref="worldpayPaymentTransactionService"/>
        <constructor-arg name="worldpayOrderService" ref="worldpayOrderService"/>
        <constructor-arg name="worldpayServiceGateway" ref="worldpayServiceGateway"/>
    </bean>

    <alias name="defaultWorldpayRedirectOrderService" alias="worldpayRedirectOrderService"/>
    <bean id="defaultWorldpayRedirectOrderService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayRedirectOrderService"
          parent="abstractWorldpayOrderService">
        <constructor-arg name="worldpayHOPService" ref="worldpayHOPService"/>
    </bean>

    <alias name="defaultWorldpayAfterRedirectValidationService" alias="worldpayAfterRedirectValidationService"/>
    <bean id="defaultWorldpayAfterRedirectValidationService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayAfterRedirectValidationService">
        <constructor-arg name="macValidator" ref="macValidator"/>
    </bean>

    <alias name="defaultWorldpayDirectOrderService" alias="worldpayDirectOrderService"/>
    <bean id="defaultWorldpayDirectOrderService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayDirectOrderService"
          parent="abstractWorldpayOrderService">
        <constructor-arg name="worldpayRequestFactory" ref="worldpayRequestFactory"/>
        <constructor-arg name="worldpaySessionService" ref="worldpaySessionService"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
    </bean>

    <alias name="defaultWorldpayRequestFactory" alias="worldpayRequestFactory"/>
    <bean id="defaultWorldpayRequestFactory"
          class="com.worldpay.service.payment.request.impl.DefaultWorldpayRequestFactory">
        <constructor-arg name="worldpayTokenEventReferenceCreationStrategy"
                         ref="worldpayTokenEventReferenceCreationStrategy"/>
        <constructor-arg name="worldpayOrderService" ref="worldpayOrderService"/>
        <constructor-arg name="worldpayKlarnaStrategy" ref="worldpayKlarnaStrategy"/>
        <constructor-arg name="worldpayRiskDataService" ref="worldpayRiskDataService"/>
        <constructor-arg name="worldpayAuthenticatedShopperIdStrategy" ref="worldpayAuthenticatedShopperIdStrategy"/>
        <constructor-arg name="worldpayKlarnaUtils" ref="worldpayKlarnaUtils"/>
        <constructor-arg name="worldpayRequestService" ref="worldpayRequestService"/>
    </bean>

    <alias name="defaultWorldpayRequestService" alias="worldpayRequestService"/>
    <bean id="defaultWorldpayRequestService"
          class="com.worldpay.service.payment.request.impl.DefaultWorldpayRequestService">
        <constructor-arg name="bankWorldpayUrlService" ref="bankTransferWorldpayUrlService"/>
        <constructor-arg name="siteConfigService" ref="siteConfigService"/>
        <constructor-arg name="worldpayAddressConverter" ref="worldpayAddressConverter"/>
        <constructor-arg name="worldpayDeliveryAddressStrategy" ref="worldpayDeliveryAddressStrategy"/>
        <constructor-arg name="worldpayDynamicInteractionResolverService"
                         ref="worldpayDynamicInteractionResolverService"/>
        <constructor-arg name="customerEmailResolutionService" ref="customerEmailResolutionService"/>
    </bean>

    <bean id="abstractWorldpayUrlService" class="com.worldpay.service.impl.AbstractWorldpayUrlService" abstract="true">
        <property name="successPath"
                  value="#{configurationService.configuration.getProperty('worldpay.config.successURL')}"/>
        <property name="pendingPath"
                  value="#{configurationService.configuration.getProperty('worldpay.config.pendingURL')}"/>
        <property name="failurePath"
                  value="#{configurationService.configuration.getProperty('worldpay.config.failureURL')}"/>
        <property name="errorPath"
                  value="#{configurationService.configuration.getProperty('worldpay.config.errorURL')}"/>
        <property name="cancelPath"
                  value="#{configurationService.configuration.getProperty('worldpay.config.cancelURL')}"/>
        <property name="threeDSecureTermPath" value="/checkout/multi/worldpay/3dsecure/sop/response"/>
        <property name="threeDSecureFlexFlowReturnUrl"
                  value="#{configurationService.configuration.getProperty('worldpay.config.3dsecureflex.jwt.returnurl')}"/>
        <property name="threeDSecureFlexAuthSubmit"
                  value="#{configurationService.configuration.getProperty('worldpay.config.3dsecureflex.secondauthorisation.submit.url')}"/>
        <property name="threeDSecureQuoteTermPath" value="/my-account/worldpay/3dsecure/sop/response"/>
        <property name="termsPath" value="/checkout/multi/termsAndConditions"/>
        <property name="klarnaConfirmationPath" value="/checkout/multi/worldpay/klarna/confirmation"/>
    </bean>

    <bean id="bankTransferWorldpayUrlService" class="com.worldpay.service.impl.DefaultWorldpayUrlService"
          parent="abstractWorldpayUrlService">
        <property name="baseSiteService" ref="baseSiteService"/>
        <property name="siteBaseUrlResolutionService" ref="siteBaseUrlResolutionService"/>
        <property name="successPath" value="/checkout/multi/worldpay/bank-transfer/hop-response"/>
        <property name="failurePath" value="/checkout/multi/worldpay/bank-transfer/hop-failure"/>
        <property name="pendingPath" value="/checkout/multi/worldpay/bank-transfer/hop-pending"/>
    </bean>

    <alias name="defaultWorldpayUrlService" alias="worldpayUrlService"/>
    <bean id="defaultWorldpayUrlService" class="com.worldpay.service.impl.DefaultWorldpayUrlService"
          parent="abstractWorldpayUrlService">
        <property name="baseSiteService" ref="baseSiteService"/>
        <property name="siteBaseUrlResolutionService" ref="siteBaseUrlResolutionService"/>
    </bean>

    <alias name="defaultWorldpayURIService" alias="worldpayURIService"/>
    <bean id="defaultWorldpayURIService" class="com.worldpay.hostedorderpage.service.impl.DefaultWorldpayURIService"/>

    <!-- checks if a payment authorization paymentTransaction is 'successful' respectively 'valid' -->
    <alias name="worldpayTransactionInfoService" alias="transactionInfoService"/>
    <bean name="worldpayTransactionInfoService" class="com.worldpay.payment.impl.WorldpayTransactionInfoService"
          parent="defaultTransactionInfoService"/>

    <alias name="defaultWorldpayAdditionalInfoService" alias="worldpayAdditionalInfoService"/>
    <bean id="defaultWorldpayAdditionalInfoService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayAdditionalInfoService">
        <constructor-arg name="worldpayCustomerIpAddressStrategy" ref="worldpayCustomerIpAddressStrategy"/>
        <constructor-arg name="sessionService" ref="sessionService"/>
    </bean>

    <alias name="defaultWorldpayPaymentTransactionService" alias="worldpayPaymentTransactionService"/>
    <bean id="defaultWorldpayPaymentTransactionService"
          class="com.worldpay.transaction.impl.DefaultWorldpayPaymentTransactionService">
        <constructor-arg name="paymentTransactionDependency" ref="dependingPaymentTransaction"/>
        <constructor-arg name="entryCodeStrategy" ref="worldpayEntryCodeStrategy"/>
        <constructor-arg name="commonI18NService" ref="commonI18NService"/>
        <constructor-arg name="modelService" ref="modelService"/>
        <constructor-arg name="worldpayPaymentTransactionDao" ref="paymentTransactionDao"/>
        <constructor-arg name="worldpayRiskScoreConverter" ref="worldpayRiskScoreConverter"/>
        <constructor-arg name="worldpayAavResponsePopulator" ref="worldpayAavResponsePopulator"/>
        <constructor-arg name="configurationService" ref="configurationService"/>
        <constructor-arg name="worldpayBankConfigurationService" ref="worldpayBankConfigurationLookupService"/>
        <constructor-arg name="worldpayOrderService" ref="worldpayOrderService"/>
    </bean>

    <alias name="defaultRecurringGenerateMerchantTransactionCodeStrategy"
           alias="recurringGenerateMerchantTransactionCodeStrategy"/>
    <bean id="defaultRecurringGenerateMerchantTransactionCodeStrategy"
          class="com.worldpay.core.services.strategies.impl.DefaultRecurringGenerateMerchantTransactionCodeStrategy">
        <property name="modelService" ref="modelService"/>
        <property name="cartService" ref="cartService"/>
    </bean>

    <bean id="worldpayPaymentInfoIsApmHandler" class="com.worldpay.attributehandlers.WorldpayPaymentInfoIsApmHandler">
        <property name="apmConfigurationLookupService" ref="apmConfigurationLookupService"/>
    </bean>

    <alias name="worldpayDynamicAttributesOrderStatusDisplayByMap" alias="dynamicAttributesOrderStatusDisplay"/>
    <bean id="worldpayDynamicAttributesOrderStatusDisplayByMap"
          class="com.worldpay.core.checkout.attribute.WorldpayOrderStatusDisplayDynamicAttributeHandler"
          parent="acceleratorDynamicAttributesOrderStatusDisplayByMap">
        <property name="worldpayPaymentTransactionService" ref="worldpayPaymentTransactionService"/>
    </bean>

    <bean id="worldpayAPMConfigurationDao" class="com.worldpay.core.dao.WorldpayAPMConfigurationDao"/>
    <bean id="worldpayEntryCodeStrategy" class="com.worldpay.transaction.impl.WorldpayEntryCodeStrategyImpl"/>

    <alias alias="worldpayCartDao" name="defaultWorldpayCartDao"/>
    <bean id="defaultWorldpayCartDao" class="com.worldpay.core.dao.impl.DefaultWorldpayCartDao"
          parent="abstractItemDao">
    </bean>

    <alias alias="worldpayCartService" name="defaultWorldpayCartService"/>
    <bean id="defaultWorldpayCartService" class="com.worldpay.core.services.impl.DefaultWorldpayCartService">
        <constructor-arg name="worldpayCartDao" ref="worldpayCartDao"/>
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="worldpaySessionService" ref="worldpaySessionService"/>
    </bean>

    <alias alias="worldpayHybrisOrderDao" name="defaultWorldpayHybrisOrderDao"/>
    <bean id="defaultWorldpayHybrisOrderDao" class="com.worldpay.core.dao.impl.DefaultWorldpayHybrisOrderDao"
          parent="abstractItemDao">
    </bean>

    <alias alias="worldpayHybrisOrderService" name="defaultWorldpayHybrisOrderService"/>
    <bean id="defaultWorldpayHybrisOrderService"
          class="com.worldpay.core.services.impl.DefaultWorldpayHybrisOrderService">
        <property name="worldpayHybrisOrderDao" ref="worldpayHybrisOrderDao"/>
        <property name="modelService" ref="modelService"/>
    </bean>

    <alias alias="apmConfigurationLookupService" name="defaultAPMConfigurationLookupService"/>
    <bean id="defaultAPMConfigurationLookupService"
          class="com.worldpay.core.services.impl.DefaultAPMConfigurationLookupService">
        <property name="worldpayAPMConfigurationDao" ref="worldpayAPMConfigurationDao"/>
    </bean>

    <alias alias="worldpayBankConfigurationLookupService" name="defaultWorldpayBankConfigurationLookupService"/>
    <bean id="defaultWorldpayBankConfigurationLookupService"
          class="com.worldpay.core.services.impl.DefaultWorldpayBankConfigurationLookupService">
        <property name="apmConfigurationLookupService" ref="apmConfigurationLookupService"/>
        <property name="worldpayBankConfigurationGenericDao" ref="worldpayBankConfigurationGenericDao"/>
    </bean>

    <bean name="worldpayBankConfigurationGenericDao"
          class="de.hybris.platform.servicelayer.internal.dao.DefaultGenericDao">
        <constructor-arg value="WorldpayBankConfiguration"/>
    </bean>

    <alias alias="paymentTransactionDao" name="worldpayPaymentTransactionDao"/>
    <bean id="worldpayPaymentTransactionDao" class="com.worldpay.core.dao.impl.DefaultWorldpayPaymentTransactionDao"
          parent="abstractItemDao">
    </bean>

    <alias name="defaultApmAvailabilityCountryStrategy" alias="apmAvailabilityCountryStrategy"/>
    <bean id="defaultApmAvailabilityCountryStrategy"
          class="com.worldpay.service.apm.strategy.impl.APMAvailabilityCountryStrategy">
        <property name="worldpayDeliveryAddressStrategy" ref="worldpayDeliveryAddressStrategy"/>
    </bean>

    <alias name="defaultWorldpayDeliveryAddressStrategy" alias="worldpayDeliveryAddressStrategy"/>
    <bean id="defaultWorldpayDeliveryAddressStrategy"
          class="com.worldpay.strategy.impl.DefaultWorldpayDeliveryAddressStrategy"/>

    <alias name="defaultApmAvailabilityCurrencyStrategy" alias="apmAvailabilityCurrencyStrategy"/>
    <bean id="defaultApmAvailabilityCurrencyStrategy"
          class="com.worldpay.service.apm.strategy.impl.APMAvailabilityCurrencyStrategy"/>

    <alias name="defaultApmAvailabilityRangeStrategy" alias="apmAvailabilityRangeStrategy"/>
    <bean id="defaultApmAvailabilityRangeStrategy"
          class="com.worldpay.service.apm.strategy.impl.APMAvailabilityRangeStrategy"/>

    <alias name="defaultApmAvailabilityBankStrategy" alias="apmAvailabilityBankStrategy"/>
    <bean id="defaultApmAvailabilityBankStrategy"
          class="com.worldpay.service.apm.strategy.impl.APMAvailabilityBankStrategy">
        <property name="worldpayBankConfigurationLookupService" ref="worldpayBankConfigurationLookupService"/>
    </bean>

    <alias name="defaultAPMAvailabilityService" alias="apmAvailabilityService"/>
    <bean id="defaultAPMAvailabilityService" class="com.worldpay.service.apm.impl.DefaultAPMAvailabilityService">
        <property name="apmAvailabilityStrategyList">
            <list>
                <ref bean="apmAvailabilityCountryStrategy"/>
                <ref bean="apmAvailabilityCurrencyStrategy"/>
                <ref bean="apmAvailabilityRangeStrategy"/>
                <ref bean="apmAvailabilityBankStrategy"/>
            </list>
        </property>
    </bean>

    <alias name="defaultPaymentInfoService" alias="worldpayPaymentInfoService"/>
    <bean id="defaultPaymentInfoService" class="com.worldpay.core.services.impl.DefaultWorldpayPaymentInfoService">
        <constructor-arg name="configurationService" ref="configurationService"/>
        <constructor-arg name="enumerationService" ref="enumerationService"/>
        <constructor-arg name="modelService" ref="modelService"/>
        <constructor-arg name="apmConfigurationLookupService" ref="apmConfigurationLookupService"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <constructor-arg name="commerceCheckoutService" ref="commerceCheckoutService"/>
        <constructor-arg name="addressService" ref="addressService"/>
    </bean>

    <alias name="defaultWorldpayOrderService" alias="worldpayOrderService"/>
    <bean id="defaultWorldpayOrderService" class="com.worldpay.service.payment.impl.DefaultWorldpayOrderService">
        <constructor-arg name="commonI18NService" ref="commonI18NService"/>
        <constructor-arg name="worldpayUrlService" ref="worldpayUrlService"/>
        <constructor-arg name="worldpayKlarnaUtils" ref="worldpayKlarnaUtils"/>
        <constructor-arg name="commerceCheckoutService" ref="commerceCheckoutService"/>
        <constructor-arg name="recurringGenerateMerchantTransactionCodeStrategy"
                         ref="recurringGenerateMerchantTransactionCodeStrategy"/>
    </bean>

    <alias name="defaultWorldpayRiskDataService" alias="worldpayRiskDataService"/>
    <bean id="defaultWorldpayRiskDataService" class="com.worldpay.service.payment.impl.DefaultWorldpayRiskDataService"/>

    <alias name="defaultWorldpayKlarnaStrategy" alias="worldpayKlarnaStrategy"/>
    <bean id="defaultWorldpayKlarnaStrategy" class="com.worldpay.service.payment.impl.DefaultWorldpayKlarnaStrategy">
        <constructor-arg name="commonI18NService" ref="commonI18NService"/>
        <constructor-arg name="worldpayUrlService" ref="worldpayUrlService"/>
    </bean>

    <alias name="defaultWorldpaySupportEmailService" alias="worldpaySupportEmailService"/>
    <bean id="defaultWorldpaySupportEmailService" class="com.worldpay.support.impl.DefaultWorldpaySupportEmailService">
        <property name="emailAppenders">
            <list>
                <ref bean="hybrisVersionAppender"/>
                <ref bean="hybrisAddonVersionAppender"/>
                <ref bean="currentTimeAppender"/>
                <ref bean="userDisplayNameAppender"/>
                <ref bean="merchantConfigurationAppender"/>
                <ref bean="configuredFlowsAppender"/>
                <ref bean="paymentTransactionAppender"/>
                <ref bean="extensionListAppender"/>
                <ref bean="clusterInformationAppender"/>
            </list>
        </property>
    </bean>

    <!-- Email Appenders -->
    <bean id="clusterInformationAppender"
          class="com.worldpay.support.appender.impl.WorldpayClusterInformationAppender"/>

    <bean id="configuredFlowsAppender" class="com.worldpay.support.appender.impl.WorldpayConfiguredFlowsAppender">
        <constructor-arg name="cmsSiteService" ref="cmsSiteService"/>
        <constructor-arg name="cmsPageDao" ref="cmsPageDao"/>
    </bean>

    <bean id="currentTimeAppender" class="com.worldpay.support.appender.impl.WorldpayCurrentTimeAppender"/>

    <bean id="extensionListAppender" class="com.worldpay.support.appender.impl.WorldpayExtensionListAppender"/>

    <bean id="merchantConfigurationAppender"
          class="com.worldpay.support.appender.impl.WorldpayMerchantConfigurationAppender"/>

    <bean id="hybrisVersionAppender" class="com.worldpay.support.appender.impl.WorldpayHybrisVersionAppender">
        <constructor-arg name="configurationService" ref="configurationService"/>
    </bean>

    <bean id="hybrisAddonVersionAppender" class="com.worldpay.support.appender.impl.WorldpayAddonVersionAppender">
        <constructor-arg name="configurationService" ref="configurationService"/>
    </bean>

    <bean id="paymentTransactionAppender"
          class="com.worldpay.support.appender.impl.WorldpayPaymentTransactionTypesAppender"/>

    <bean id="userDisplayNameAppender" class="com.worldpay.support.appender.impl.WorldpayUserDisplayNameAppender">
        <constructor-arg name="userService" ref="userService"/>
    </bean>

    <alias name="defaultWorldpaySupportService" alias="worldpaySupportService"/>
    <bean id="defaultWorldpaySupportService" class="com.worldpay.support.impl.DefaultWorldpaySupportService">
        <constructor-arg name="configurationService" ref="configurationService"/>
        <constructor-arg name="worldpaySupportEmailService" ref="worldpaySupportEmailService"/>
    </bean>

    <alias name="defaultWorldpayTokenEventReferenceCreationStrategy"
           alias="worldpayTokenEventReferenceCreationStrategy"/>
    <bean id="defaultWorldpayTokenEventReferenceCreationStrategy"
          class="com.worldpay.service.payment.impl.DefaultWorldpayTokenEventReferenceCreationStrategy">
        <property name="cartService" ref="cartService"/>
    </bean>

    <alias name="defaultWorldpayAuthenticatedShopperIdStrategy" alias="worldpayAuthenticatedShopperIdStrategy"/>
    <bean id="defaultWorldpayAuthenticatedShopperIdStrategy"
          class="com.worldpay.strategy.impl.DefaultWorldpayAuthenticatedShopperIdStrategy"/>

    <alias name="defaultWorldpayAuthorisationResultService" alias="worldpayAuthorisationResultService"/>
    <bean id="defaultWorldpayAuthorisationResultService"
          class="com.worldpay.service.impl.DefaultWorldpayAuthorisationResultService"/>

    <!-- Interceptors -->
    <bean id="worldpayTxDataCodeGenerator"
          class="de.hybris.platform.servicelayer.keygenerator.impl.PersistentKeyGenerator">
        <property name="key" value="worldpay_payment"/>
        <property name="digits" value="8"/>
        <property name="start" value="00000000"/>
    </bean>

    <bean id="worldpayItemCodePrepareInterceptor" class="com.worldpay.interceptors.WorldpayItemCodePrepareInterceptor">
        <property name="keyGenerator" ref="worldpayTxDataCodeGenerator"/>
        <property name="typeService" ref="typeService"/>
        <property name="fieldName" value="code"/>
    </bean>

    <bean id="worldpayPaymentInfoRemoveInterceptor"
          class="com.worldpay.interceptors.WorldpayPaymentInfoRemoveInterceptor">
        <property name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <property name="worldpayDirectOrderService" ref="worldpayDirectOrderService"/>
    </bean>

    <!--Interceptor Mapping-->
    <bean id="worldpayAavResponseInterceptorMapping"
          class="de.hybris.platform.servicelayer.interceptor.impl.InterceptorMapping">
        <property name="interceptor" ref="worldpayItemCodePrepareInterceptor"/>
        <property name="typeCode" value="WorldpayAavResponse"/>
    </bean>
    <bean id="worldpayRiskScoreInterceptorMapping"
          class="de.hybris.platform.servicelayer.interceptor.impl.InterceptorMapping">
        <property name="interceptor" ref="worldpayItemCodePrepareInterceptor"/>
        <property name="typeCode" value="WorldpayRiskScore"/>
    </bean>
    <bean id="worldpayPaymentInfoRemoveInterceptorMapping"
          class="de.hybris.platform.servicelayer.interceptor.impl.InterceptorMapping">
        <property name="interceptor" ref="worldpayPaymentInfoRemoveInterceptor"/>
        <property name="typeCode" value="PaymentInfo"/>
    </bean>

    <util:map id="paymentTransactionTypeMap" map-class="java.util.HashMap"
              key-type="com.worldpay.enums.order.AuthorisedStatus"
              value-type="de.hybris.platform.payment.enums.PaymentTransactionType">
        <entry key="AUTHORISED" value="AUTHORIZATION"/>
        <entry key="CAPTURED" value="CAPTURE"/>
        <entry key="REFUSED" value="REFUSED"/>
        <entry key="CANCELLED" value="CANCEL"/>
    </util:map>

    <util:map id="dependingPaymentTransaction"
              key-type="de.hybris.platform.payment.enums.PaymentTransactionType"
              value-type="de.hybris.platform.payment.enums.PaymentTransactionType">
        <entry key="CAPTURE" value="AUTHORIZATION"/>
    </util:map>

    <!-- Fraud service -->
    <alias alias="fraudService" name="worldpayFraudService"/>
    <bean id="worldpayFraudService" class="de.hybris.platform.fraud.impl.DefaultFraudService">
        <property name="providers">
            <list>
                <ref bean="worldpayFraudServiceProvider"/>
            </list>
        </property>
    </bean>

    <bean id="worldpayFraudServiceProvider" class="de.hybris.platform.fraud.impl.DefaultHybrisFraudServiceProvider">
        <property name="providerName" value="worldpay"/>
        <property name="symptomList">
            <list>
                <ref bean="worldpayRiskScoreFraudSymptom"/>
                <ref bean="worldpayRiskGuardianFraudSymptom"/>
            </list>
        </property>
    </bean>

    <bean id="worldpayRiskGuardianFraudSymptom" class="com.worldpay.fraud.symptoms.WorldpayRiskGuardianFraudSymptom">
        <property name="symptomName" value="WorldpayRiskGuardianFraudSymptom"/>
        <property name="configurationService" ref="configurationService"/>
    </bean>

    <bean id="worldpayRiskScoreFraudSymptom" class="com.worldpay.fraud.symptoms.WorldpayRiskScoreFraudSymptom">
        <property name="symptomName" value="WorldpayRiskValueFraudSymptom"/>
        <property name="configurationService" ref="configurationService"/>
    </bean>

    <!-- Cancellation strategies -->
    <bean id="worldpayOrderCancelDenialStrategy"
          class="com.worldpay.ordercancel.impl.denialstrategies.WorldpayOrderCancelDenialStrategy">
        <property name="reason">
            <bean class="de.hybris.platform.ordercancel.DefaultOrderCancelDenialReason">
                <property name="code" value="4"/>
                <property name="description"
                          value="Order cannot be cancelled as there are captured transaction entries."/>
            </bean>
        </property>
    </bean>

    <bean id="worldpayCancelOrderServiceListMergeDirective" depends-on="orderCancelService" parent="listMergeDirective">
        <property name="add" ref="worldpayOrderCancelDenialStrategy"/>
        <property name="listPropertyDescriptor" value="cancelDenialStrategies"/>
    </bean>

    <bean id="worldpayApmOrderCancelDenialStrategy"
          class="com.worldpay.ordercancel.impl.denialstrategies.WorldpayApmOrderCancelDenialStrategy">
        <property name="reason">
            <bean class="de.hybris.platform.ordercancel.DefaultOrderCancelDenialReason">
                <property name="code" value="5"/>
                <property name="description"
                          value="Order cannot be cancelled as payment was made through an APM or is still unknown."/>
            </bean>
        </property>
    </bean>

    <bean id="worldpayApmCancelOrderServiceListMergeDirective" depends-on="orderCancelService"
          parent="listMergeDirective">
        <property name="add" ref="worldpayApmOrderCancelDenialStrategy"/>
        <property name="listPropertyDescriptor" value="cancelDenialStrategies"/>
    </bean>

    <alias name="defaultWorldpayCheckoutService" alias="worldpayCheckoutService"/>
    <bean id="defaultWorldpayCheckoutService" class="com.worldpay.core.checkout.impl.DefaultWorldpayCheckoutService">
        <property name="modelService" ref="modelService"/>
    </bean>

    <alias name="defaultWorldpayPaymentCheckoutFacade" alias="worldpayPaymentCheckoutFacade"/>
    <bean id="defaultWorldpayPaymentCheckoutFacade"
          class="com.worldpay.facades.order.impl.DefaultWorldpayPaymentCheckoutFacade">
        <constructor-arg name="checkoutFacade" ref="checkoutFacade"/>
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="customerAccountService" ref="customerAccountService"/>
        <constructor-arg name="worldpayCheckoutService" ref="worldpayCheckoutService"/>
    </bean>

    <alias name="defaultWorldpayApplePayPaymentCheckoutFacade" alias="worldpayApplePayPaymentCheckoutFacade"/>
    <bean id="defaultWorldpayApplePayPaymentCheckoutFacade"
          class="com.worldpay.facades.order.impl.DefaultWorldpayApplePayPaymentCheckoutFacade">
        <property name="i18NFacade" ref="i18NFacade"/>
        <property name="checkoutCustomerStrategy" ref="checkoutCustomerStrategy"/>
        <property name="userFacade" ref="userFacade"/>
        <property name="worldpayPaymentCheckoutFacade" ref="worldpayPaymentCheckoutFacade"/>
        <property name="worldpayMerchantConfigDataFacade" ref="worldpayMerchantConfigDataFacade"/>
        <property name="applePayConfigDataToValidateMerchantRequestDTOPopulatingConverter"
                  ref="applePayConfigDataToValidateMerchantRequestDTOPopulatingConverter"/>
    </bean>

    <alias name="defaultWorldpayKlarnaPaymentCheckoutFacade" alias="worldpayKlarnaPaymentCheckoutFacade"/>
    <bean id="defaultWorldpayKlarnaPaymentCheckoutFacade"
          class="com.worldpay.facades.order.impl.DefaultWorldpayKlarnaPaymentCheckoutFacade">
        <property name="checkoutFacade" ref="checkoutFacade"/>
        <property name="cartService" ref="cartService"/>
        <property name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <property name="orderInquiryService" ref="orderInquiryService"/>
        <property name="worldpayOrderService" ref="worldpayOrderService"/>
    </bean>

    <alias name="worldpayCheckoutFacadeDecorator" alias="worldpayCheckoutFacade"/>
    <bean id="worldpayCheckoutFacadeDecorator" class="com.worldpay.facades.order.impl.WorldpayCheckoutFacadeDecorator">
        <constructor-arg name="checkoutFlowFacade" ref="checkoutFlowFacade"/>
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="addressConverter" ref="addressConverter"/>
        <constructor-arg name="checkoutCustomerStrategy" ref="checkoutCustomerStrategy"/>
        <constructor-arg name="commerceCheckoutService" ref="commerceCheckoutService"/>
    </bean>

    <alias name="defaultAPMAvailabilityFacade" alias="apmAvailabilityFacade"/>
    <bean id="defaultAPMAvailabilityFacade" class="com.worldpay.facades.impl.DefaultAPMAvailabilityFacade">
        <property name="apmAvailabilityService" ref="apmAvailabilityService"/>
        <property name="cartService" ref="cartService"/>
    </bean>

    <alias name="defaultWorldpayHostedOrderFacade" alias="worldpayHostedOrderFacade"/>
    <bean id="defaultWorldpayHostedOrderFacade"
          class="com.worldpay.facades.payment.hosted.impl.DefaultWorldpayHostedOrderFacade">
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="sessionService" ref="sessionService"/>
        <constructor-arg name="worldpayOrderInfoStrategy" ref="worldpayOrderInfoStrategy"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <constructor-arg name="worldpayRedirectOrderService" ref="worldpayRedirectOrderService"/>
        <constructor-arg name="worldpayMerchantConfigDataFacade" ref="worldpayMerchantConfigDataFacade"/>
        <constructor-arg name="worldpayPaymentInfoService" ref="worldpayPaymentInfoService"/>
    </bean>

    <alias name="defaultWorldpayAfterRedirectValidationFacade" alias="worldpayAfterRedirectValidationFacade"/>
    <bean id="defaultWorldpayAfterRedirectValidationFacade"
          class="com.worldpay.facades.payment.hosted.impl.DefaultWorldpayAfterRedirectValidationFacade">
        <constructor-arg name="sessionService" ref="sessionService"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
        <constructor-arg name="worldpayAfterRedirectValidationService" ref="worldpayAfterRedirectValidationService"/>
    </bean>

    <alias name="defaultWorldpayHOPNoReturnParamsStrategy" alias="worldpayHOPNoReturnParamsStrategy"/>
    <bean id="defaultWorldpayHOPNoReturnParamsStrategy"
          class="com.worldpay.facades.payment.hosted.impl.DefaultWorldpayHOPNoReturnParamsStrategy">
        <constructor-arg name="cartService" ref="cartService"/>
    </bean>

    <alias name="defaultWorldpayBankConfigurationFacade" alias="worldpayBankConfigurationFacade"/>
    <bean id="defaultWorldpayBankConfigurationFacade"
          class="com.worldpay.facades.impl.DefaultWorldpayBankConfigurationFacade">
        <constructor-arg name="worldpayBankConfigurationLookupService" ref="worldpayBankConfigurationLookupService"/>
        <constructor-arg name="bankConfigurationModelBankConfigurationDataConverter"
                         ref="bankConfigurationModelBankConfigurationDataConverter"/>
        <constructor-arg name="apmConfigurationLookupService" ref="apmConfigurationLookupService"/>
    </bean>

    <alias name="defaultWorldpayAdditionalInfoFacade" alias="worldpayAdditionalInfoFacade"/>
    <bean id="defaultWorldpayAdditionalInfoFacade"
          class="com.worldpay.facades.payment.impl.DefaultWorldpayAdditionalInfoFacade">
        <constructor-arg name="worldpayAdditionalInfoService" ref="worldpayAdditionalInfoService"/>
    </bean>

    <alias name="defaultWorldpayCartFacade" alias="worldpayCartFacade"/>
    <bean id="defaultWorldpayCartFacade" class="com.worldpay.facades.impl.DefaultWorldpayCartFacade">
        <property name="worldpayCartService" ref="worldpayCartService"/>
        <property name="cartService" ref="cartService"/>
    </bean>

    <alias name="defaultWorldpayDirectOrderFacade" alias="worldpayDirectOrderFacade"/>
    <bean id="defaultWorldpayDirectOrderFacade"
          class="com.worldpay.facades.payment.direct.impl.DefaultWorldpayDirectOrderFacade">
        <constructor-arg name="worldpayAuthenticatedShopperIdStrategy" ref="worldpayAuthenticatedShopperIdStrategy"/>
        <constructor-arg name="worldpayDirectOrderService" ref="worldpayDirectOrderService"/>
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="acceleratorCheckoutFacade" ref="acceleratorCheckoutFacade"/>
        <constructor-arg name="worldpayPaymentInfoService" ref="worldpayPaymentInfoService"/>
        <constructor-arg name="worldpayMerchantConfigDataFacade" ref="worldpayMerchantConfigDataFacade"/>
        <constructor-arg name="cartFacade" ref="cartFacade"/>
        <constructor-arg name="worldpayCartService" ref="worldpayCartService"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
    </bean>

    <alias name="defaultOrderInquiryService" alias="orderInquiryService"/>
    <bean id="defaultOrderInquiryService" class="com.worldpay.core.services.impl.DefaultOrderInquiryService">
        <property name="worldpayPaymentInfoService" ref="worldpayPaymentInfoService"/>
        <property name="worldpayServiceGateway" ref="worldpayServiceGateway"/>
        <property name="configurationService" ref="configurationService"/>
    </bean>

    <alias name="defaultWorldpayDynamicInteractionResolverService" alias="worldpayDynamicInteractionResolverService"/>
    <bean id="defaultWorldpayDynamicInteractionResolverService"
          class="com.worldpay.service.interaction.impl.DefaultWorldpayDynamicInteractionResolverService">
        <property name="assistedServiceService" ref="assistedServiceService"/>
    </bean>

    <alias name="defaultWorldpayJsonWebTokenService" alias="worldpayJsonWebTokenService"/>
    <bean id="defaultWorldpayJsonWebTokenService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayJsonWebTokenService">
        <constructor-arg ref="worldpayUrlService"/>
    </bean>

    <alias name="defaultWorldpayDirectResponseService" alias="worldpayDirectResponseService"/>
    <bean id="defaultWorldpayDirectResponseService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayDirectResponseService"/>

    <alias name="defaultWorldpayAddonEndpointService" alias="worldpayAddonEndpointService"/>
    <bean id="defaultWorldpayAddonEndpointService"
          class="com.worldpay.service.impl.DefaultWorldpayAddonEndpointService"/>

    <alias name="defaultWorldpayDirectResponseFacade" alias="worldpayDirectResponseFacade"/>
    <bean id="defaultWorldpayDirectResponseFacade"
          class="com.worldpay.facades.impl.DefaultWorldpayDirectResponseFacade">
        <constructor-arg ref="worldpayDirectResponseService"/>
        <constructor-arg ref="worldpayCheckoutFacade"/>
        <constructor-arg ref="worldpayUrlService"/>
        <constructor-arg ref="worldpayJsonWebTokenService"/>
        <constructor-arg ref="worldpayMerchantConfigDataFacade"/>
        <constructor-arg ref="worldpaySessionService"/>
    </bean>

    <alias name="defaultWorldpaySessionService" alias="worldpaySessionService"/>
    <bean name="defaultWorldpaySessionService"
          class="com.worldpay.service.payment.impl.DefaultWorldpaySessionService">
        <constructor-arg ref="sessionService"/>
    </bean>

    <alias name="defaultOccWorldpaySessionService" alias="occWorldpaySessionService"/>
    <bean name="defaultOccWorldpaySessionService" class="com.worldpay.service.payment.impl.OccWorldpaySessionService">
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="modelService" ref="modelService"/>
    </bean>

    <bean id="occWorldpayDirectResponseFacade"
          class="com.worldpay.facades.impl.DefaultWorldpayDirectResponseFacade">
        <constructor-arg ref="worldpayDirectResponseService"/>
        <constructor-arg ref="worldpayCheckoutFacade"/>
        <constructor-arg ref="worldpayUrlService"/>
        <constructor-arg ref="worldpayJsonWebTokenService"/>
        <constructor-arg ref="worldpayMerchantConfigDataFacade"/>
        <constructor-arg name="worldpaySessionService" ref="occWorldpaySessionService"/>
    </bean>

    <bean id="occWorldpayDirectOrderService"
          class="com.worldpay.service.payment.impl.DefaultWorldpayDirectOrderService"
          parent="abstractWorldpayOrderService">
        <constructor-arg name="worldpayRequestFactory" ref="worldpayRequestFactory"/>
        <constructor-arg name="worldpaySessionService" ref="occWorldpaySessionService"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
    </bean>
    <bean id="occWorldpayDirectOrderFacade"
          class="com.worldpay.facades.payment.direct.impl.DefaultWorldpayDirectOrderFacade">
        <constructor-arg name="worldpayAuthenticatedShopperIdStrategy" ref="worldpayAuthenticatedShopperIdStrategy"/>
        <constructor-arg name="worldpayDirectOrderService" ref="occWorldpayDirectOrderService"/>
        <constructor-arg name="cartService" ref="cartService"/>
        <constructor-arg name="acceleratorCheckoutFacade" ref="acceleratorCheckoutFacade"/>
        <constructor-arg name="worldpayPaymentInfoService" ref="worldpayPaymentInfoService"/>
        <constructor-arg name="worldpayMerchantConfigDataFacade" ref="worldpayMerchantConfigDataFacade"/>
        <constructor-arg name="cartFacade" ref="cartFacade"/>
        <constructor-arg name="worldpayCartService" ref="worldpayCartService"/>
        <constructor-arg name="worldpayMerchantInfoService" ref="worldpayMerchantInfoService"/>
    </bean>


    <alias name="defaultWorldpayCancelWholeOrderDueToCancelNotificationStrategy"
           alias="worldpayCancelWholeOrderDueToCancelNotificationStrategy"/>
    <bean id="defaultWorldpayCancelWholeOrderDueToCancelNotificationStrategy"
          class="com.worldpay.orderprocess.strategies.cancel.impl.DefaultWorldpayCancelWholeOrderDueToCancelNotificationStrategy">
        <constructor-arg name="worldpayPaymentTransactionService" ref="worldpayPaymentTransactionService"/>
        <constructor-arg name="modelService" ref="modelService"/>
    </bean>

    <alias name="defaultWorldpayDDCFacade" alias="worldpayDDCFacade"/>
    <bean id="defaultWorldpayDDCFacade" class="com.worldpay.facades.payment.direct.impl.DefaultWorldpayDDCFacade">
        <constructor-arg name="worldpayJsonWebTokenService" ref="worldpayJsonWebTokenService"/>
        <constructor-arg name="worldpayMerchantConfigDataFacade" ref="worldpayMerchantConfigDataFacade"/>
    </bean>

    <alias name="defaultWorldpayHOPService" alias="worldpayHOPService"/>
    <bean id="defaultWorldpayHOPService" class="com.worldpay.service.hop.impl.DefaultWorldpayHOPService">
        <constructor-arg name="sessionService" ref="sessionService"/>
        <constructor-arg name="worldpayRequestFactory" ref="worldpayRequestFactory"/>
        <constructor-arg name="worldpayServiceGateway" ref="worldpayServiceGateway"/>
        <constructor-arg name="worldpayURIService" ref="worldpayURIService"/>
        <constructor-arg name="worldpayUrlService" ref="worldpayUrlService"/>
    </bean>

    <alias name="defaultWorldpayUserFacade" alias="userFacade"/>
    <bean id="defaultWorldpayUserFacade" class="com.worldpay.facades.impl.DefaultWorldpayUserFacade">
        <constructor-arg name="apmPaymentInfoConverter" ref="apmPaymentInfoConverter"/>
        <constructor-arg name="userFacade" ref="defaultUserFacade"/>
        <constructor-arg name="checkoutCustomerStrategy" ref="checkoutCustomerStrategy"/>
        <constructor-arg name="creditCardPaymentInfoConverter" ref="creditCardPaymentInfoConverter"/>
        <constructor-arg name="customerAccountService" ref="worldpayCustomerAccountService"/>
    </bean>

    <alias name="defaultWorldpayKlarnaUtils" alias="worldpayKlarnaUtils"/>

    <bean id="defaultWorldpayKlarnaUtils" class="com.worldpay.klarna.impl.DefaultWorldpayKlarnaUtils">
        <constructor-arg name="klarnaPayments" ref="klarnaPayments"/>
    </bean>


    <bean id="worldpayAPMPaymentInfoIsKlarnaPaymentTypeCodeDynamicAttributeHandler"
          class="com.worldpay.attributehandlers.WorldpayAPMPaymentInfoIsKlarnaPaymentTypeCodeDynamicAttributeHandler">
        <constructor-arg name="worldpayKlarnaUtils" ref="worldpayKlarnaUtils"/>
    </bean>
</beans>
